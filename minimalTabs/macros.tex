% How does this work:
% 1) big letters (G, E, D, ...) are active characters and do this: write the tune name, and start a box to also write possible further characters (\sharp etc.)
% 2) bars (|) are active characters and do this: end a box, write it if it is non-empty, write a bar, and start a box again (this time for characters like t19p15~ denoting holding strings)
% 3) dashes (-) are active characters, also end a box, write dash, start a box.
% 4) newline (^^M) is active character, ends a group and writes a newline.


\newcounter{row}
\newcounter{column}
\newcounter{bugs}

% making those to active characters for creating nice tabs
% from ascii tabs without typing commands
\def\changeCatcodes{%
    \catcode`E=13
    \catcode`H=13
    \catcode`G=13
    \catcode`D=13
    \catcode`A=13
}

\def\changeSpecialCatcodes{%
    \catcode`-=13
    \catcode`|=13
    \catcode`\^^M=13
}

\def\changeBackSpecialCatcodes{%
    \catcode`-=12
    \catcode`|=12
    \catcode`\^^M=5
}

% global definitions for future active characters (assuming that those aren't
% used anywhere else as active chars)
\begingroup
\changeCatcodes
\gdefE{\tune{\string E}}
\gdefH{\tune{\string H}}
\gdefG{\tune{\string G}}
\gdefD{\tune{\string D}}
\gdefA{\tune{\string A}}
\endgroup

% print string tune letter
\gdef\tune#1{.\hbox to 10pt{#1}}

% write bar
\gdef\writebar{\raisebox{-.4ex}{\rule{.3ex}{2.5ex}}}

% gets additional text after / before one of (tune letter, -, |), and decides what to do with it
\gdef\gettext#1{(--- this is the text: #1 ---)}

\gdef\extendstring{\raisebox{.8ex}{\rule{.8em}{.5pt}}}



\gdef\newstring{\penalty-10000}

\gdef\makevbox#1{\vbox{#1}}

% have to change catcodes before definition to avoid global redefinition
% of ~, | and -, and define them locally inside.
% (tune letters G, D, A, E etc. can be defined globally without possible clash)
\changeSpecialCatcodes
\def\mytabenv{%\makevbox
    \begingroup
    \showoutput
    \showboxdepth=3
    \setlength{\parindent}{0pt}
    \baselineskip=0pt\lineskiplimit=0pt\lineskip=0pt\relax
    \changeSpecialCatcodes
    \let-\extendstring
    \let|\writebar
    \let^^M\newstring

    \changeCatcodes
}
\changeBackSpecialCatcodes

\def\endmytabenv{\endgroup}
